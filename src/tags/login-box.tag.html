<login-box>
	<button type="button" class="close" onclick="{ close }" title="Close">Ã—</button>
	<form name="loginform" class="loginform" onsubmit="{ submitLogin }" hide="{ isAuthenticated }">
		<input name="username" type="text" placeholder="Username"></input>
		<input name="password" type="password" placeholder="Password"></input>
		<button type="submit">Login</button>
	</form>
	<form name="logoutform" class="loginform" onsubmit="{ submitLogout }" show="{ isAuthenticated }">
		<label>Logged in as { username.value }</label>
		<button type="submit">Logout</button>
	</form>

	<script>
		var tag = this;
		
		tag.mixin('userServiceMixin');
		
		tag.isAuthenticated = false;
		tag.isOpen = isOpen;
		tag.toggle = toggle;
        tag.open = open;
		tag.close = close;
		tag.submitLogin = submitLogin;
		tag.submitLogout = submitLogout;
		tag.reactToAuthentication = reactToAuthentication;
		tag.reactToUnauthentication = reactToUnauthentication;
		
		tag.eventBus.on(tag.AppEvents.Elements.LoginBox.Toggle, tag.toggle);
		tag.eventBus.on(tag.AppEvents.State.Authenticated, tag.reactToAuthentication);
		tag.eventBus.on(tag.AppEvents.State.Unauthenticated, tag.reactToUnauthentication);
		
		/* Implementations */
		
        function isOpen() {
            return (tag.root.style.display != 'none');
        };
		
		function toggle() {
            if (tag.isOpen()) {
                tag.close();
            } else {
                tag.open();
            }
		};
        
        function open() {
            tag.root.style.display = '';
			tag.username.focus();
        };
        
        function close() {
            tag.root.style.display = 'none';
        };

		function submitLogin(event) {
			tag.userService.login(tag.username.value, tag.password.value);
		};
		
		function submitLogout(event) {
			tag.userService.logout(tag.username.value);
		};
		
		function reactToAuthentication() { 
			tag.isAuthenticated = true;
			tag.update();
			tag.close();
		}
		
		function reactToUnauthentication() { 
			tag.isAuthenticated = false;
			tag.update();
			tag.close();
		}
        
	</script>

	<style scoped>
		:scope {
			display: block;
			position: absolute;
			right: 0;
			width: 300px;
			/*height: 200px;*/
			background-color: #28c;
            /*border: 2px solid #39d;*/
			z-index: 100;
		}

		@media (max-width: 700px) {
			:scope {
				width: 100%;
			}
		}

		.close {
            /*display: block;*/
			font-weight: bold;
		    position: absolute;
		    right: 0;
		    margin: 0.5em;
			height: 1.5em;
			line-height: 0.7rem;
		}

		form {
			margin: 0.5em;
			min-height: 30px; /* hm.. */
		}

		form input[type=text],
		form input[type=password] {
			width: 60%;
			margin-bottom: 0.6em;
		}
        
        form button[type=submit] {
            position: absolute;
            height: 70%;
            width: 20%;
            display: block;
            left: 65%;
            top: 10%;
        }
		
		form label {
			color: white;
			margin: 0.3em;
    		display: inline-block;
		}
	</style>
</login-box>